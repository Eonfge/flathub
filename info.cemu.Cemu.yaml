app-id: info.cemu.Cemu
runtime: org.gnome.Platform
runtime-version: '42'
sdk: org.gnome.Sdk

command: slade
finish-args:
  - --device=dri
  - --socket=x11
  - --share=ipc
  - --socket=pulseaudio

# Base editor requirements
  - --filesystem=home

# required for start page
  - --share=network

cleanup:
  - /app/include
  - /app/lib/*.a
  - /app/lib/*.la
  - /app/lib/pkgconfig

modules:

  # Required so we can use wxWidgets with openGL integration
  - shared-modules/glu/glu-9.json
  - shared-modules/glew/glew.json

  - name: wxwidgets
    buildsystem: autotools
    config-opts:
      - --with-gtk=3
      - --disable-sdltest
      - --enable-shared
      - --enable-webview
      - --enable-webviewwebkit
      - --with-opengl
      - --with-sdl
      - --with-libiconv=/usr
    sources:
      - type: git
        url: https://github.com/wxWidgets/wxWidgets
        tag: v3.1.5
        commit: 9c0a8be1dc32063d91ed1901fd5fcd54f4f955a1
        x-checker-data:
          type: anitya
          project-id: 5150
          stable-only: true
          tag-template: v$version
          versions:
            <: '3.1.6'

  # Dependency that vcpkg is trying to reel in
  # https://github.com/cemu-project/Cemu/tree/main/dependencies/vcpkg_overlay_ports/fmt
  - name: fmt
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    sources:
      - type: archive
        url: https://github.com/fmtlib/fmt/archive/refs/tags/7.1.3.tar.gz
        sha256: 5cae7072042b3043e12d53d50ef404bbb76949dad1de368d7f993a15c8c05ecc
        x-checker-data:
          type: anitya
          project-id: 11526
          url-template: https://github.com/fmtlib/fmt/archive/refs/tags/$version.tar.gz   
          versions:
            <: '7.1.4'         
            
  - name: cemu
    buildsystem: cmake-ninja
    builddir: true
    build-options:    
      env:
        CC: clang
        CXX: clang++
        AR: llvm-ar
        RANLIB: llvm-ranlib
      ldflags: -fuse-ld=lld
      prepend-ld-library-path: /usr/lib/sdk/llvm12/lib
      prepend-path: /usr/lib/sdk/llvm12/bin
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -G Ninja
      - -DCMAKE_MAKE_PROGRAM=/usr/bin/ninja
      - -DCMAKE_C_COMPILER=/usr/bin/clang-12
      - -DCMAKE_CXX_COMPILER=/usr/bin/clang++-12
    sources:
      - type: git
        url: https://github.com/cemu-project/Cemu
        tag: v2.0
        commit: 80ce0c9a46766e016daee5055d927513436caa84
  
