app-id: com.faforever.Client
runtime: org.freedesktop.Platform
runtime-version: '21.08'
sdk: org.freedesktop.Sdk
command: /app/bin/faf-client

build-options:
  no-debuginfo: true
  no-debuginfo-compression: true

finish-args:
  - --share=network
  - --socket=wayland
  - --socket=pulseaudio

  # Legacy X11 support
  - --socket=fallback-x11
  - --share=ipc
  - --device=dri

  # Notifications and such
  - --talk-name=org.freedesktop.Notifications

  # Developer tool, thus we can be more generous
  - --filesystem=home
    
  # Interactions with Steam
  - --talk-name=com.valvesoftware.Steam

  # Java paths
  - --env=PATH=/app/clients/bin:/app/jre/bin:/usr/bin
  - --env=JAVA_HOME=/app/jre
  - --env=INSTALL4J_JAVA_HOME=/app/jre

modules:

  # Upstream is very strict about their version of Java. Let's just roll with it
  - name: openjdk15
    buildsystem: simple
    build-commands:
      - mkdir /app/jre/
      - cp -r ./* /app/jre/
    sources:
      - type: archive
        url: https://github.com/AdoptOpenJDK/openjdk15-binaries/releases/download/jdk-15.0.2%2B7/OpenJDK15U-jdk_x64_linux_hotspot_15.0.2_7.tar.gz
        sha256: 94f20ca8ea97773571492e622563883b8869438a015d02df6028180dd9acc24d

  - name: client
    buildsystem: simple
    build-commands:
      - mkdir /app/bin/
      - cp -r ./* /app/bin/
    sources:
      - type: archive
        url: https://github.com/FAForever/downlords-faf-client/releases/download/v2021.10.0/dfc_unix_2021_10_0.tar.gz
        sha256: 9c49aab5c21dbe9b7a49fe0eca3310407147a002f0e9e3ccbae5faec36e196c5

  - name: metadata
    buildsystem: simple
    build-commands:
      - install -Dm644 com.faforever.Client.desktop /app/share/applications/com.faforever.Client.desktop
      - install -Dm644 com.faforever.Client.metainfo.xml /app/share/metainfo/com.faforever.Client.metainfo.xml
      - install -Dm644 com.faforever.Client.128.png /app/share/icons/hicolor/128x128/apps/com.faforever.Client.png
      - install -Dm644 com.faforever.Client.256.png /app/share/icons/hicolor/256x256/apps/com.faforever.Client.png
    sources:
      - type: file
        path: com.faforever.Client.128.png
      - type: file
        path: com.faforever.Client.256.png
      - type: file
        path: com.faforever.Client.desktop
      - type: file
        path: com.faforever.Client.metainfo.xml

